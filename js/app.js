!function(){"use strict";var t="undefined"!=typeof window?window:global;if("function"!=typeof t.require){var e={},n={},i=function(t,e){return{}.hasOwnProperty.call(t,e)},s=function(t,e){var n,i,s=[];n=/^\.\.?(\/|$)/.test(e)?[t,e].join("/").split("/"):e.split("/");for(var o=0,r=n.length;r>o;o++)i=n[o],".."===i?s.pop():"."!==i&&""!==i&&s.push(i);return s.join("/")},o=function(t){return t.split("/").slice(0,-1).join("/")},r=function(e){return function(n){var i=o(e),r=s(i,n);return t.require(r,e)}},a=function(t,e){var i={id:t,exports:{}};return n[t]=i,e(i.exports,r(t),i),i.exports},l=function(t,o){var r=s(t,".");if(null==o&&(o="/"),i(n,r))return n[r].exports;if(i(e,r))return a(r,e[r]);var l=s(r,"./index");if(i(n,l))return n[l].exports;if(i(e,l))return a(l,e[l]);throw new Error('Cannot find module "'+t+'" from "'+o+'"')},h=function(t,n){if("object"==typeof t)for(var s in t)i(t,s)&&(e[s]=t[s]);else e[t]=n},u=function(){var t=[];for(var n in e)i(e,n)&&t.push(n);return t};t.require=l,t.require.define=h,t.require.register=h,t.require.list=u,t.require.brunch=!0}}(),require.register("event-types",function(t,e,n){var i;n.exports=i=function(){function t(){}return t.DRAGON={ALLELES_CHANGED:"alleles changed"},t.MEIOSIS={GAMETE_SELECTED:"meiosis.gamete-selected",RESET:"meiosis.retry",OFFSPRING_CREATED:"meiosis.offspring-created"},t}()}),require.register("events",function(t,e,n){var i;n.exports=i=function(){function t(){}return t.dispatchEvent=function(t,e){var n;return null!=document.dispatchEvent?(n=new CustomEvent(t,{detail:e}),document.dispatchEvent(n)):console.warn("document doesn't support dispatchEvent!")},t.addEventListener=function(t,e){return null!=document.addEventListener?document.addEventListener(t,e):console.warn("document doesn't support addEventListener!")},t}(),function(){var t;return window.CustomEvent&&"function"==typeof window.CustomEvent?void 0:(t=function(t,e){var n;return n=document.createEvent("CustomEvent"),n.initCustomEvent(t,!(!e||!e.bubbles),!(!e||!e.cancelable),e?e.detail:null),n},window.CustomEvent=t)}(),function(){var t;return null==window.TouchEvent?(console.log("Shimming TouchEvent..."),window.TouchEvent=t=function(){function t(){}return t}()):void 0}(),function(){return window.Events=i}()}),require.register("helpers",function(t,e,n){var i=[].slice,s={}.hasOwnProperty,o=function(t,e){function n(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Array.prototype.remove=function(t,e){var n;return n=this.slice((e||t)+1||this.length),this.length=0>t?this.length+t:t,this.push.apply(this,n)},Array.prototype.removeObj=function(t){var e;return e=this.indexOf(t),~e?(this.remove(e),!0):!1},Array.prototype.replaceFirst=function(t,e){return this[this.indexOf(t)]=e},Array.prototype.shuffle=function(){var t,e,n;if(n=this.length)for(;--n;)t=Math.floor(Math.random()*(n+1)),e=this[t],this[t]=this[n],this[n]=e;return this},Array.prototype.randomElement=function(){return this[Math.floor(Math.random()*this.length)]},window.ExtMath={},ExtMath.randomInt=function(t){return Math.floor(Math.random()*t)},ExtMath.randomFloat=function(t){return null==t&&(t=1),Math.random()*t},ExtMath.randomValue=function(t,e){var n,i;return e>=t?(i=t,n=e):(i=e,n=t),i+Math.random()*(n-i)},ExtMath.randomGaussianIrwinHall=function(t){var e,n,i;for(null==t&&(t={}),null==t.mean&&(t.mean=0),null==t.deviation&&(t.deviation=1),n=0,e=i=1;12>=i;e=++i)n+=Math.random()-.5;return n*t.deviation+t.mean},ExtMath._haveNextNextGuassian=!1,ExtMath._nextNextGuassian=0,ExtMath.randomGaussianJava=function(t){var e,n,i,s;if(null==t&&(t={}),ExtMath._haveNextNextGaussian)return ExtMath._haveNextNextGaussian=!1,ExtMath._nextNextGaussian;for(n=0;n>=1||0===n;)i=2*Math.random()-1,s=2*Math.random()-1,n=i*i+s*s;return e=Math.sqrt(-2*Math.log(n)/n),ExtMath._nextNextGaussian=s*e,ExtMath._haveNextNextGaussian=!0,i*e},ExtMath.randomGaussian=function(t){return null==t&&(t={}),ExtMath.randomGaussianJava(t)},ExtMath.flip=function(){return ExtMath.randomInt(2)},ExtMath.HALF_PI=Math.PI/2,ExtMath.TWO_PI=2*Math.PI,ExtMath.normalizeRads=function(t){return t-ExtMath.TWO_PI*Math.floor((t+Math.PI)/ExtMath.TWO_PI)},n.exports={setDefaults:function(t,e){var n;for(n in e)void 0===t[n]?t[n]=e[n]:"object"==typeof t[n]&&(t[n]=this.setDefaults(t[n],e[n]));return t},clone:function(t){var e,n;if(null==t||"object"!=typeof t)return t;e=new t.constructor;for(n in t)e[n]=this.clone(t[n]);return e},showMessage:function(t,e,n){var i,s,o,r,a,l,h,u,c;for(c=document.getElementsByClassName("message-box"),h=0,u=c.length;u>h;h++)r=c[h],r.remove();return a=e.offsetTop+50,l=280,o=e.offsetLeft+e.offsetWidth/2-l/2,i=document.createElement("div"),i.classList.add("message-box"),i.setAttribute("style","top: "+a+"px;\nleft: "+o+"px;\nwidth: "+l+"px;"),i.innerHTML=t,s=document.createElement("div"),s.classList.add("button"),s.innerHTML="Ok",s.addEventListener("click",function(){return e.removeChild(i),n?n():void 0}),i.appendChild(s),e.appendChild(i)},stringify:function(t){var e,n;if(null==t||"object"!=typeof t)return String(t);n="{ ";for(e in t)n+=String(e)+": "+this.stringify(t[e]+", ");return n.slice(0,n.length-2)+" }"},preload:function(t,e){var n,i,s,o,r,a,l,h,u,c,d,p;for(a=document.createElement("div"),a.classList.add("preload-message"),l=document.createElement("div"),l.classList.add("text"),l.innerHTML="Loading... 0% complete.",a.appendChild(l),document.body.appendChild(a),i=[],h=0,c=t.length;c>h;h++)if(r=t[h],null!=r.preload)for(p=r.preload,u=0,d=p.length;d>u;u++)n=p[u],i.push(n);return o=null,s=new PIXI.AssetLoader(i),s.onProgress=function(){return o||(o=s.loadCount+1),l.innerHTML="Loading... "+Math.floor((o-s.loadCount)/o*100)+"%"},s.onComplete=function(){return l.innerHTML="Loading complete!",setTimeout(function(){return e(),document.body.removeChild(a)},10)},s.load()},mixOf:function(){var t,e,n,s,r,a,l,h,u;for(e=arguments[0],r=2<=arguments.length?i.call(arguments,1):[],t=function(t){function e(){return h=e.__super__.constructor.apply(this,arguments)}return o(e,t),e}(e),l=r.length-1;l>=0;l+=-1){s=r[l],u=s.prototype;for(a in u)n=u[a],t.prototype[a]=n}return t},defaults:function(t,e){var n,i;for(n in e)s.call(e,n)&&(i=e[n],null==t[n]&&(t[n]=i));return t},disableAlleles:function(t,e){var n,i,o,a,l;a=t.geneList,l=[];for(o in a)s.call(a,o)&&(i=a[o],l.push(function(){var t,s,o;for(o=[],t=0,s=e.length;s>t;t++)n=e[t],o.push(r.call(i.alleles,n)>=0?i.alleles.splice(i.alleles.indexOf(n),1):void 0);return o}()));return l}}}),require.register("models/meiosis-support",function(t,e,n){var i,s={}.hasOwnProperty;n.exports=i=function(){function t(){}return t.processAlleleString=function(t,e){var n,i,s,o,r,a,l,h,u,c,d,p,m;if(null==e&&(e=BioLogica.Species.Dragon),null==t)return[];for(null==e.genesToChromosome&&(e.genesToChromosome=this.generateGeneToChromosomeMap(e)),a=e.genesToChromosome,i=t.split(/,/),s={},c=0,d=i.length;d>c;c++)l=i[c],p=l.split(/:/),h=p[0],n=p[1],r=BioLogica.Genetics.getGeneOfAllele(e,n).name,o=""+a[r],"XY"===o&&(o="X"),h=h.toUpperCase(),null==(null!=(m=s[o])?m[h]:void 0)?(u=[n],null==s[o]&&(s[o]={}),s[o][h]=u):s[o][h].push(n);return s},t.generateGeneToChromosomeMap=function(t){var e,n,i,s,o,r,a,l;o={},l=t.chromosomeGeneMap;for(i in l)for(n=l[i],r=0,a=n.length;a>r;r++)e=n[r],s=BioLogica.Genetics.getGeneOfAllele(t,e).name,o[s]=i;return o},t.allelesToJSON=function(t){var e,n,i,o,r,a,l,h,u,c,d;if(null==t)return null;l=this.processAlleleString(t),console.log(l),a=[];for(r in l)if(s.call(l,r)){u=l[r];for(h in u)if(s.call(u,h)){for(i=u[h],o=[],c=0,d=i.length;d>c;c++)e=i[c],n={sex:"A"===h?"female":"male",gene:e},o.push(n);a.push({alleles:o})}null==u.B&&a.push({alleles:[{sex:"male",gene:""},{sex:"male",gene:""}]})}return{chromosomes:a}},t.JSONToAlleles=function(t,e){var n,i,s;return s="",i=this._JSONToAlleles(t,"a:"),n=this._JSONToAlleles(e,"b:"),i+n},t._JSONToAlleles=function(t,e){var n,i,s,o,r,a,l,h,u;for(s="",h=t.chromosomes,o=0,a=h.length;a>o;o++)for(i=h[o],u=i.alleles,r=0,l=u.length;l>r;r++)n=u[r],s+=e+n.gene+",";return s},t.getOffspringSex=function(t){var e,n;return e=t.chromosomes[2].alleles,n=BioLogica.FEMALE,(e.length<1||""===e[0].gene||"Y"===e[0].gene)&&(n=BioLogica.MALE),n},t}()}),require.register("state-machine",function(t,e,n){var i;n.exports=i=function(){function t(){}return t.prototype._states=null,t.prototype.addState=function(t,e){return null==this._states&&(this._states=[]),this._states[t]=e},t.prototype.setState=function(t){if(null==this._states[t])throw new Error("No such state: "+t);return this.currentState=t,null!=this._states[this.currentState].enter?this._states[this.currentState].enter.apply(this):void 0},t.prototype.send=function(t,e){if(null==this.currentState)throw new Error("No current state exists to handle '"+t+"'");return null!=this._states[this.currentState][t]?this._states[this.currentState][t].apply(this,[e]):"touchstart"===t&&null!=this._states[this.currentState].click?(e.preventDefault(),this._states[this.currentState].click.apply(this,[e])):void 0},t}()}),require.register("views/dragon-chromosome-pulldown-view",function(t,e,n){var i,s,o,r=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};o=e("events"),s=e("event-types"),n.exports=i=function(){function t(t,e,n){this.dragon=t,this.hiddenGenes=n.hiddenGenes,this.hiddenAlleles=n.hiddenAlleles,null==this.hiddenAlleles&&(this.hiddenAlleles=[]),null==this.hiddenGenes&&(this.hiddenGenes=[]),this.div=$(e)[0],this.species=BioLogica.Species.Dragon,this._injectHtml()}return t.prototype.setDragon=function(t){return this.dragon=t,this.div.innerHTML="",this._injectHtml()},t.prototype._injectHtml=function(){var t,e,n,i,s,o,r,a=this;for(o=this.species.chromosomeNames,r=[],i=0,s=o.length;s>i;i++)t=o[i],e=this.species.chromosomeGeneMap[t].map(function(t){return a.dragon.genetics.geneForAllele(t)}),r.push(function(){var i,s,o,r;for(o=["A","B"],r=[],i=0,s=o.length;s>i;i++)n=o[i],r.push(this._injectChromosome(t,n,e));return r}.call(this));return r},t.prototype._injectChromosome=function(t,e,n){var i,a,l,h,u,c,d,p,m,f,g,v,E,_,L=this;if(h=this._chromoLabel(t,e),a=this.dragon.genetics.genotype.chromosomes[t][this._biologicaSide(t,e)],l=document.createElement("div"),l.classList.add("chromosome"),l.classList.add(h),l.classList.add(e),d=document.createElement("div"),d.classList.add("chromosome-label"),d.innerHTML="Chromosome: "+h,l.appendChild(d),c=document.createElement("img"),c.classList.add("chromosome-image"),c.src="images/dragons/chromosomes/"+h+e+".png",l.appendChild(c),"XY"!==t||"B"!==e||this.dragon.sex!==BioLogica.MALE)for(f=0,v=n.length;v>f;f++)if(u=n[f],!(r.call(this.hiddenGenes,u)>=0)){for(m=document.createElement("select"),m.name=""+h+e+"-"+u,m.classList.add(u),"XY"===t&&"B"===e&&this.dragon.sex===BioLogica.MALE&&m.classList.add("hidden"),l.appendChild(m),_=this.species.geneList[u].alleles,g=0,E=_.length;E>g;g++)i=_[g],r.call(this.hiddenAlleles,i)>=0||(p=document.createElement("option"),p.value=i,p.innerHTML=i,r.call(a.alleles,i)>=0&&($(p).prop("selected",!0),$(m).data("previous",i)),m.appendChild(p));null==$(m).data("previous")&&$(m).data("previous",this.species.geneList[u].alleles[0]),$(m).change(function(n){var i,r;return i=$(n.target).val(),r=$(n.target).data("previous"),L.dragon.genetics.genotype.replaceAllele(a,r,i),L.dragon.resetPhenotype(),$(n.target).data("previous",i),o.dispatchEvent(s.DRAGON.ALLELES_CHANGED,{dragon:L.dragon,source:L,oldVal:r,newVal:i,chromosome:t,side:e})})}return this.div.appendChild(l)},t.prototype._chromoLabel=function(t,e){var n;return n=t,"XY"===t&&(n="A"===e?"X":this.dragon.sex===BioLogica.MALE?"Y":"X"),n},t.prototype._biologicaSide=function(t,e){return"XY"===t?this.dragon.sex===BioLogica.FEMALE?"A"===e?"x1":"x2":"A"===e?"x":"y":e.toLowerCase()},t}()}),require.register("views/dragon-meiosis-view",function(t,e,n){var i,s,o,r;o=e("helpers"),r=e("models/meiosis-support"),s=e("event-types"),n.exports=i=function(){function t(e,n,i){this.dragon=e,null==i&&(i={}),this.opts=o.defaults(i,t._defaults),this.jsonData=null,this.motherData=null,this.fatherData=null,this._parent=$(n),this._setupListeners(),this._reset()}return t._defaults={species:BioLogica.Species.Dragon,hiddenGenes:[],mode:"offspring",swapping:"none",meiosisOwner:"offspring",width:300,height:300,jsonDataUrl:void 0},t.prototype.getLabelForAllele=function(t){return this.opts.species.alleleLabelMap[t]},t.prototype._setupListeners=function(){var t=this;return Events.addEventListener(s.MEIOSIS.RESET,function(e){return e.detail.owner===t.opts.meiosisOwner&&e.detail.mode===t.opts.mode?(t._reset(),Events.dispatchEvent(s.MEIOSIS.GAMETE_SELECTED,{owner:t.opts.meiosisOwner,gamete:null})):void 0}),Events.addEventListener(s.MEIOSIS.GAMETE_SELECTED,function(e){return"offspring"===t.opts.mode?("mother"===e.detail.owner?t.motherData=e.detail.gamete:t.fatherData=e.detail.gamete,t._reset()):void 0})},t.prototype._reset=function(){return this._setJsonData(),this._injectHtml(),this._initAnimation()},t.prototype._setJsonData=function(){return"offspring"===this.opts.mode?(null!=this.motherData&&null!=this.fatherData?(this.jsonData={chromosomes:[]},this.jsonData.chromosomes=this.jsonData.chromosomes.concat(this.motherData.chromosomes),this.jsonData.chromosomes=this.jsonData.chromosomes.concat(this.fatherData.chromosomes)):this.jsonData=null!=this.motherData?this.motherData:null!=this.fatherData?this.fatherData:null,Events.dispatchEvent(s.MEIOSIS.OFFSPRING_CREATED,{offspring:null})):null!=this.dragon?this.jsonData=r.allelesToJSON(this.dragon.getAlleleString()):void 0},t.prototype._initAnimation=function(){var t;return null==this.jsonData&&(this.jsonData=this.opts.jsonDataUrl),t={mode:this.opts.mode,swap:"none"!==this.opts.swapping,owner:this.opts.meiosisOwner,mother:this.motherData,father:this.fatherData,segMoveSpeed:5,width:this.opts.width,height:this.opts.height,context:this,loaded:this._animationLoaded,animationComplete:this._animationComplete,gameteSelected:this._gameteSelected,playButtonPressed:this._playButtonPressed,endButtonPressed:this._endButtonPressed,reachedRecombination:this._reachedRecombination,allelesSelected:this._allelesSelected,swapCompleted:this._swapCompleted,ySwapAttempted:this._ySwapAttempted},null==this._div&&this._injectHtml(),null!=this.jsonData?this._div.geniverse(this.jsonData,t):void 0},t.prototype._injectHtml=function(){var t,e;return t=document.createElement("div"),t.classList.add("meiosis"),e="",e+='<div class="cell"></div>',e+='<div class="controls">',e+='<div class="buttons">',e+='<button class="stop"><img src="images/meiosis/meiosis_stop_small.png" /></button>',e+='<button class="play"><img src="images/meiosis/meiosis_play_small.png" /></button>',e+='<button class="end"><img src="images/meiosis/meiosis_end_small.png" /></button>',"parent"===this.opts.mode&&("none"!==this.opts.swapping&&(e+='<button class="swap"><img src="images/meiosis/meiosis_exchange_16x16_monochrome.png" /></button>'),e+='<button class="retry"><img src="images/meiosis/meiosis_retry_monochrome.png" /></button>'),e+="</div>",e+='<div class="scrub"></div>',e+="</div>",t.innerHTML=e,this._parent[0].innerHTML="",this._parent[0].appendChild(t),this._div=$(t)},t.prototype._animationLoaded=function(){return void 0},t.prototype._animationComplete=function(){var t,e,n;return"offspring"===this.opts.mode?(t=r.JSONToAlleles(this.motherData,this.fatherData),n=r.getOffspringSex(this.fatherData),e=BioLogica.Organism.createOrganism(this.opts.species,t,n),Events.dispatchEvent(s.MEIOSIS.OFFSPRING_CREATED,{offspring:e})):void 0},t.prototype._gameteSelected=function(t){return Events.dispatchEvent(s.MEIOSIS.GAMETE_SELECTED,{owner:this.opts.meiosisOwner,gamete:t})},t.prototype._playButtonPressed=function(){return void 0},t.prototype._endButtonPressed=function(){return void 0},t.prototype._reachedRecombination=function(){return void 0},t.prototype._allelesSelected=function(){return void 0},t.prototype._swapCompleted=function(){return void 0},t.prototype._ySwapAttempted=function(){return void 0},t}()}),require.register("views/dragon-view",function(t,e,n){var i,s,o,r={}.hasOwnProperty,a=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};o=e("events"),s=e("event-types"),n.exports=i=function(){function t(t,e,n){this.dragon=t,this.showSex=n.showSex,this.showCharacteristics=n.showCharacteristics,this.visibleTraits=n.visibleTraits,null==this.showSex&&(this.showSex=!0),null==this.showCharacteristics&&(this.showCharacteristics=!1),null==this.visibleTraits&&(this.visibleTraits=[]),this._addListeners(),this.div=$(e)[0],this.div.classList.add("dragon-view-parent"),this._injectHtml(),this._updateClasses()}return t.prototype.setDragon=function(t){return this.dragon=t,this._updateClasses(),this._updateCharacteristics(),this._updateSexLabel(),this._updateVisibility()},t.prototype.setSexVisible=function(t){return this.showSex=t,this._updateVisibility()},t.prototype.setCharacteristicsVisible=function(t){return this.showCharacteristics=t,this._updateVisibility()},t.prototype._addListeners=function(){var t=this;return o.addEventListener(s.DRAGON.ALLELES_CHANGED,function(e){return e.detail.dragon===t.dragon?(t._updateClasses(),t._updateCharacteristics(),t._updateSexLabel()):void 0})},t.prototype._updateClasses=function(){var t,e,n,i,s;if(this.phenoView.setAttribute("class",""),this.phenoView.classList.add("dragon-view"),null==this.dragon)return void this.phenoView.classList.add("no-dragon");for(i=this.dragon.getAllCharacteristics(),s=[],e=0,n=i.length;n>e;e++)t=i[e],t=t.toLowerCase().replace(" ","-"),s.push(this.phenoView.classList.add(t));return s},t.prototype._updateVisibility=function(){return null!=this.dragon&&this.showSex?this.sexLabel.classList.contains("hidden")&&this.sexLabel.classList.remove("hidden"):this.sexLabel.classList.add("hidden"),null!=this.dragon&&this.showCharacteristics?this.characteristicList.classList.contains("hidden")?this.characteristicList.classList.remove("hidden"):void 0:this.characteristicList.classList.add("hidden")},t.prototype._updateCharacteristics=function(){var t,e,n,i;if(null!=this.dragon){e=[],i=this.dragon.phenotype.characteristics;for(n in i)r.call(i,n)&&(t=i[n],this.visibleTraits.length>0&&a.call(this.visibleTraits,n)<0||e.push("<span class='trait'>"+n+":</span> <span class='characteristic'>"+t+"</span>"));return this.characteristicList.innerHTML=e.join("")}},t.prototype._updateSexLabel=function(){return null!=this.dragon?this.sexLabel.innerHTML=this.dragon.sex===BioLogica.MALE?"male":"female":void 0},t.prototype._injectHtml=function(){var t,e,n,i,s;for(this.phenoView=document.createElement("div"),this.phenoView.classList.add("dragon-view"),this.div.appendChild(this.phenoView),s=["body","dead","fire","head","plates","scales","wings"],n=0,i=s.length;i>n;n++)t=s[n],e=document.createElement("img"),e.classList.add(t),e.src="images/dragons/"+t+".png",this.phenoView.appendChild(e);return this.sexLabel=document.createElement("div"),this.sexLabel.classList.add("sex-label"),this.showSex||this.sexLabel.classList.add("hidden"),this.div.appendChild(this.sexLabel),this.characteristicList=document.createElement("div"),this.characteristicList.classList.add("characteristic-list"),this.showCharacteristics||this.characteristicList.classList.add("hidden"),this.div.appendChild(this.characteristicList),this._updateSexLabel(),this._updateCharacteristics(),this._updateVisibility()},t}()});