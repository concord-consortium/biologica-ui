{"version":3,"file":"public/js/app.js","sources":["app/event-types.coffee","app/events.coffee","app/helpers.coffee","app/models/meiosis-support.coffee","app/state-machine.coffee","app/views/dragon-chromosome-pulldown-view.coffee","app/views/dragon-meiosis-view.coffee","app/views/dragon-view.coffee"],"names":[],"mappings":"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","sourcesContent":["\n###\n  This is a simple helper class for defining event types.\n###\n\nmodule.exports = class EventTypes\n  @DRAGON:\n    ALLELES_CHANGED: 'alleles changed'\n  @MEIOSIS:\n    GAMETE_SELECTED: 'meiosis.gamete-selected'\n    RESET: 'meiosis.retry'\n    OFFSPRING_CREATED: 'meiosis.offspring-created'\n","\n###\n  This is a simple helper library for dispatching custom events.\n  While not strictly necessary, it also includes a polyfill for supporting\n  event dispatching on browsers that don't have CustomEvent support.\n###\n\nmodule.exports = class Events\n  @dispatchEvent: (type, data)->\n    if document.dispatchEvent?\n      evt = new CustomEvent type, {detail: data}\n      document.dispatchEvent evt\n    else\n      console.warn(\"document doesn't support dispatchEvent!\")\n\n  @addEventListener: (type, callback)->\n    if document.addEventListener?\n      document.addEventListener(type, callback)\n    else\n      console.warn(\"document doesn't support addEventListener!\")\n\n(->\n  unless (window.CustomEvent and typeof window.CustomEvent is 'function')\n    CustomEvent = ( type, eventInitDict ) ->\n      newEvent = document.createEvent('CustomEvent')\n      newEvent.initCustomEvent(type,\n        !!(eventInitDict && eventInitDict.bubbles),\n        !!(eventInitDict && eventInitDict.cancelable),\n        (if eventInitDict then eventInitDict.detail else null))\n      return newEvent;\n\n    window.CustomEvent = CustomEvent\n)()\n\n\n(->\n  unless window.TouchEvent?\n    # Firefox > 24 doesn't expose TouchEvent to the desktop browser version. Create a class to prevent NPE's in the code.\n    console.log \"Shimming TouchEvent...\"\n    window.TouchEvent = class TouchEvent\n)()\n\n(-> window.Events = Events)()\n","# [a,b,c,d].remove(1) => [a,c,d]\n# [a,b,c,d].remove(0,2) => [d]\nArray::remove = (from, to) ->\n  rest = this.slice((to || from) + 1 || this.length)\n  this.length = if from < 0 then this.length + from else from\n  return this.push.apply(this, rest)\n\nArray::removeObj = (obj) ->\n  i = this.indexOf(obj)\n  if ~i\n    this.remove(i)\n    true\n  else\n    false\n\nArray::replaceFirst = (obj, replacement) ->\n  this[this.indexOf(obj)] = replacement\n\nArray::shuffle = ->\n  top = @length\n  if top\n    while (--top)\n      current = Math.floor(Math.random() * (top + 1))\n      tmp = this[current]\n      this[current] = this[top]\n      this[top] = tmp\n  return this\n\nArray::randomElement = ->\n  return this[Math.floor Math.random() * @length]\n\nwindow.ExtMath = {}\n\nExtMath.randomInt = (max) ->\n  Math.floor Math.random() * max\n\nExtMath.randomFloat = (max=1) ->\n  Math.random() * max\n\nExtMath.randomValue = (a, b) ->\n  if a <= b\n    min = a\n    max = b\n  else\n    min = b\n    max = a\n  min + Math.random() * (max - min)\n\nExtMath.randomGaussianIrwinHall = (opts={}) ->\n  opts.mean = 0 unless opts.mean?\n  opts.deviation = 1 unless opts.deviation?\n\n  # a 12th order Irwin-Hall distribution, which is a close approximation of a\n  # standard normal distribution and is faster than other typical methods.\n  v = 0\n  for i in [1..12]\n    v += (Math.random() - 0.5)\n  return v * opts.deviation + opts.mean\n\nExtMath._haveNextNextGuassian = false\nExtMath._nextNextGuassian = 0\nExtMath.randomGaussianJava = (opts={}) ->\n  if ExtMath._haveNextNextGaussian\n    ExtMath._haveNextNextGaussian = false\n    return ExtMath._nextNextGaussian\n  else\n    s = 0\n    while s >= 1 or s is 0\n      v1 = 2 * Math.random() - 1   # between -1.0 and 1.0\n      v2 = 2 * Math.random() - 1   # between -1.0 and 1.0\n      s = v1 * v1 + v2 * v2\n    multiplier = Math.sqrt(-2 * Math.log(s)/s)\n    ExtMath._nextNextGaussian = v2 * multiplier\n    ExtMath._haveNextNextGaussian = true\n    return v1 * multiplier\n\nExtMath.randomGaussian= (opts={}) ->\n  # return ExtMath.randomGaussianIrwinHall(opts)\n  return ExtMath.randomGaussianJava(opts)\n\nExtMath.flip = ->\n  ExtMath.randomInt(2)\n\nExtMath.HALF_PI = Math.PI / 2\nExtMath.TWO_PI  = Math.PI * 2\n\nExtMath.normalizeRads = (t) ->\n  t - ExtMath.TWO_PI * Math.floor((t + Math.PI) / ExtMath.TWO_PI)\n\nmodule.exports =\n\n  ###\n    Given an object of default values:\n    defaultOptions = {\n      a: \"a\",\n      b: \"b\",\n      c: {\n        d: \"d\",\n        e: \"e\"\n      }\n    }\n\n    and an object of options\n    options = {\n      a: \"A\",\n      c: {\n        d: \"D\"\n        f: \"F\"\n      }\n    }\n\n    this will set defaults for any undefined values, included those\n    in nested objects:\n\n    setDefaults(options, defaultOptions) = {\n      a: \"A\",\n      b: \"b\",\n      c: {\n        d: \"D\",\n        e: \"e\",\n        f: \"F\"\n      }\n    }\n  ###\n  setDefaults: (opts, defaults) ->\n    for p of defaults\n      if (opts[p] is undefined)\n        opts[p] = defaults[p]\n      else if (typeof opts[p] is \"object\")\n        opts[p] = @setDefaults(opts[p], defaults[p]);\n    opts\n\n  ###\n    Deep-copy an object\n  ###\n  clone: (obj) ->\n    if not obj? or typeof obj isnt 'object'\n      return obj\n\n    cloneObj = new obj.constructor()\n\n    for key of obj\n      cloneObj[key] = @clone obj[key]\n\n    return cloneObj\n\n  showMessage: (message, element, callback) ->\n    oldBox.remove() for oldBox in document.getElementsByClassName(\"message-box\")\n\n    top   = element.offsetTop + 50\n    width = 280\n    left  = element.offsetLeft + (element.offsetWidth/2) - (width/2)\n\n    box = document.createElement 'div'\n    box.classList.add 'message-box'\n    box.setAttribute \"style\",\n      \"\"\"\n        top: #{top}px;\n        left: #{left}px;\n        width: #{width}px;\n      \"\"\"\n\n    box.innerHTML = message\n\n    button = document.createElement 'div'\n    button.classList.add 'button'\n    button.innerHTML = \"Ok\"\n    button.addEventListener 'click', ->\n      element.removeChild box\n      if callback then callback()\n    box.appendChild button\n\n    element.appendChild box\n\n  stringify: (obj)->\n    if not obj? or typeof obj isnt 'object'\n      return String(obj)\n\n    str = \"{ \"\n    for key of obj\n      str += String(key) + \": \" + @stringify obj[key] + \", \"\n\n    return str.slice(0,str.length-2) + \" }\"\n\n  # sources is an array of objects, each which have a 'preload' property.\n  # the 'preload' property is an array of strings which will be treated as urls.\n  # The strings can be image paths or paths to json files specifying assets\n  # ex: preload([{preload: [\"foo.jpg\", \"bar.png\"]},{preload: [\"baz.json\"]}], function() {/**all done**/})\n  preload: (sources, callback)->\n    statusContainer = document.createElement 'div'\n    statusContainer.classList.add 'preload-message'\n    statusDom = document.createElement 'div'\n    statusDom.classList.add 'text'\n    statusDom.innerHTML = \"Loading... 0% complete.\"\n    statusContainer.appendChild statusDom\n    document.body.appendChild statusContainer\n\n    assets = []\n    for source in sources\n      continue unless source.preload?\n      for asset in source.preload\n        assets.push asset\n\n    numImages = null\n\n    loader = new PIXI.AssetLoader(assets)\n\n    loader.onProgress = ->\n      if not numImages\n        numImages = loader.loadCount + 1\n      statusDom.innerHTML = \"Loading... \"+Math.floor((numImages-loader.loadCount)/numImages*100)+\"%\"\n    loader.onComplete = ->\n      statusDom.innerHTML = \"Loading complete!\"\n      setTimeout ->\n        callback()\n        document.body.removeChild statusContainer\n      , 10\n    loader.load()\n\n  mixOf: (base, mixins...) ->\n    class Mixed extends base\n    for mixin in mixins by -1 #earlier mixins override later ones\n      for name, method of mixin::\n        Mixed::[name] = method\n    Mixed\n\n  defaults: (opts, defaults) ->\n    for own k,v of defaults\n      opts[k] = v unless opts[k]?\n    return opts\n\n  disableAlleles: (species, alleles) ->\n    for own geneName, gene of species.geneList\n      for allele in alleles\n        if allele in gene.alleles\n          gene.alleles.splice(gene.alleles.indexOf(allele), 1)\n","module.exports = class MeiosisSupport\n\n  @processAlleleString: (alleleString, species=BioLogica.Species.Dragon) ->\n    return [] unless alleleString?\n\n    species.genesToChromosome ?= @generateGeneToChromosomeMap(species)\n    map = species.genesToChromosome\n    alleleSet = alleleString.split(/,/)\n    alleles = {}\n    for rawAllele in alleleSet\n      [side, allele] = rawAllele.split(/:/)\n      gene = BioLogica.Genetics.getGeneOfAllele(species, allele).name\n      chromo = \"\"+map[gene]\n      chromo = 'X' if chromo is 'XY'\n      side = side.toUpperCase()\n\n      if not alleles[chromo]?[side]?\n        values = [allele]\n        alleles[chromo] ?= {}\n        alleles[chromo][side] = values;\n      else\n        alleles[chromo][side].push(allele)\n\n    return alleles\n\n  @generateGeneToChromosomeMap: (species) ->\n    map = {}\n    for chromo, alleles of species.chromosomeGeneMap\n      for allele in alleles\n        gene = BioLogica.Genetics.getGeneOfAllele(species, allele).name\n        map[gene] = chromo\n    return map\n\n  @allelesToJSON: (alleleString) ->\n    return null unless alleleString?\n\n    genetics = @processAlleleString(alleleString)\n    console.log(genetics)\n\n    chromosomesArr = []\n    for own chromo,sides of genetics\n      for own side,alleles of sides\n        allelesArr = []\n        for allele in alleles\n          alleleDef =\n            sex: if side is 'A' then 'female' else 'male'\n            gene: allele\n          allelesArr.push(alleleDef)\n\n        chromosomesArr.push({ alleles: allelesArr})\n\n      if not sides.B?\n        # fake some B side info so the chromosome looks ok\n        chromosomesArr.push({ alleles: [{ sex: \"male\", gene: \"\" },{ sex: \"male\", gene: \"\" }]})\n\n    return { chromosomes: chromosomesArr }\n\n  @JSONToAlleles: (motherJson, fatherJson) ->\n    outString = \"\"\n\n    motherString = @_JSONToAlleles(motherJson, \"a:\")\n    fatherString = @_JSONToAlleles(fatherJson, \"b:\")\n\n    return motherString + fatherString\n\n  @_JSONToAlleles: (json, prefix) ->\n    outString = \"\"\n    for chromo in json.chromosomes\n      for allele in chromo.alleles\n        outString += prefix + allele.gene + \",\"\n    return outString\n\n  @getOffspringSex: (fatherChromosomes) ->\n    lastChromoAlleles = fatherChromosomes.chromosomes[2].alleles\n    sex = BioLogica.FEMALE\n    if lastChromoAlleles.length < 1 or lastChromoAlleles[0].gene is \"\" or lastChromoAlleles[0].gene is 'Y'\n      sex = BioLogica.MALE\n    return sex\n","###\n  This is a simple implementation of a state machine, which allows\n  transitioning to named states and delegation of events to the\n  current state.\n###\n\nmodule.exports = class StateMachine\n\n  _states: null\n\n  ###\n    Add a named state with a set of event handlers.\n\n    e.g.\n      addState \"addingAgents\",\n        enter: ->\n          console.log \"We are now in 'Adding Agents' mode!\"\n        click: (evt) ->\n          addAgentAt evt.x, evt.y\n        rightClick: (evt) ->\n          removeAgent evt.x, evt.y\n  ###\n  addState: (name, state) ->\n    if !@_states? then @_states = []\n\n    @_states[name] = state\n\n  setState: (currentState) ->\n    if !@_states[currentState]?\n      throw new Error(\"No such state: #{currentState}\")\n\n    @currentState = currentState\n    if @_states[@currentState].enter?\n      @_states[@currentState].enter.apply @\n\n  send: (evtName, evt) ->\n    if !@currentState?\n      throw new Error(\"No current state exists to handle '#{evtName}'\")\n\n    if @_states[@currentState][evtName]?\n      @_states[@currentState][evtName].apply @, [evt]\n    # oddly, touch quit generating 'click' events, so here's a workaround for it\n    else if evtName is \"touchstart\" and @_states[@currentState]['click']?\n      evt.preventDefault()\n      @_states[@currentState]['click'].apply @, [evt]\n","Events = require 'events'\nEventTypes = require 'event-types'\n\nmodule.exports = class DragonChromosomePulldownView\n  constructor: (@dragon, domId, {@hiddenGenes, @hiddenAlleles})->\n    @hiddenAlleles ?= []\n    @hiddenGenes ?= []\n    @div = $(domId)[0]\n    @species = BioLogica.Species.Dragon\n\n    @_injectHtml()\n\n  setDragon: (@dragon) ->\n    @div.innerHTML = \"\"\n    @_injectHtml()\n\n  _injectHtml: ->\n    for chromo in @species.chromosomeNames\n      genes = @species.chromosomeGeneMap[chromo].map (allele)=> @dragon.genetics.geneForAllele(allele)\n\n      for side in ['A','B']\n        @_injectChromosome(chromo, side, genes)\n\n  _injectChromosome: (chromo, side, genes)->\n    chromoLabel = @_chromoLabel(chromo, side)\n    bioChromosome = @dragon.genetics.genotype.chromosomes[chromo][@_biologicaSide(chromo, side)]\n\n    chromoElem = document.createElement 'div'\n    chromoElem.classList.add 'chromosome'\n    chromoElem.classList.add chromoLabel\n    chromoElem.classList.add side\n\n    labelElem = document.createElement 'div'\n    labelElem.classList.add 'chromosome-label'\n    labelElem.innerHTML = 'Chromosome: ' + chromoLabel\n    chromoElem.appendChild(labelElem)\n\n    imageElem = document.createElement 'img'\n    imageElem.classList.add 'chromosome-image'\n    imageElem.src = \"images/dragons/chromosomes/#{chromoLabel}#{side}.png\"\n    chromoElem.appendChild imageElem\n\n    unless chromo is 'XY' and side is 'B' and @dragon.sex is BioLogica.MALE\n      # Allele pulldowns\n      for gene in genes\n        continue if gene in @hiddenGenes\n        sel = document.createElement 'select'\n        sel.name = \"#{chromoLabel}#{side}-#{gene}\"\n        sel.classList.add gene\n        sel.classList.add 'hidden' if chromo is 'XY' and side is 'B' and @dragon.sex is BioLogica.MALE\n        chromoElem.appendChild sel\n        for allele in @species.geneList[gene].alleles\n          continue if allele in @hiddenAlleles\n          opt = document.createElement 'option'\n          opt.value = allele\n          opt.innerHTML = allele\n          if allele in bioChromosome.alleles\n            $(opt).prop('selected', true)\n            $(sel).data('previous', allele)\n          sel.appendChild opt\n\n        $(sel).data('previous', @species.geneList[gene].alleles[0]) unless $(sel).data('previous')?\n        $(sel).change (evt)=>\n          newVal = $(evt.target).val()\n          oldVal = $(evt.target).data('previous')\n          @dragon.genetics.genotype.replaceAllele(bioChromosome, oldVal, newVal)\n          @dragon.resetPhenotype()\n          $(evt.target).data('previous', newVal)\n          Events.dispatchEvent EventTypes.DRAGON.ALLELES_CHANGED, {dragon: @dragon, source: @, oldVal: oldVal, newVal: newVal, chromosome: chromo, side: side}\n\n\n    @div.appendChild chromoElem\n\n  _chromoLabel: (chromo, side)->\n    chromoLabel = chromo\n    if chromo is 'XY'\n      if side is 'A'\n        chromoLabel = 'X'\n      else if @dragon.sex is BioLogica.MALE\n        chromoLabel = 'Y'\n      else\n        chromoLabel = 'X'\n\n    return chromoLabel\n\n  _biologicaSide: (chromo, side)->\n    if chromo is 'XY'\n      if @dragon.sex is BioLogica.FEMALE\n        return if side is 'A' then 'x1' else 'x2'\n      else\n        return if side is 'A' then 'x' else 'y'\n    else\n      return side.toLowerCase()\n","Helpers = require('helpers')\nMeiosisSupport = require('models/meiosis-support')\nEventTypes = require('event-types')\n\nmodule.exports = class DragonMeiosisView\n  @_defaults:\n    species: BioLogica.Species.Dragon\n    hiddenGenes: []\n    mode: 'offspring'  # 'offspring' or 'parent'\n    swapping: 'none'   # 'none' or ... ???\n    meiosisOwner: 'offspring'  # 'offspring', 'mother', 'father'\n    width: 300\n    height: 300\n    jsonDataUrl: undefined\n\n  constructor: (@dragon, domId, opts={}) ->\n    @opts = Helpers.defaults opts, DragonMeiosisView._defaults\n    @jsonData = null\n    @motherData = null\n    @fatherData = null\n    @_parent = $(domId)\n    @_setupListeners()\n    @_reset()\n\n  getLabelForAllele: (allele)->\n    @opts.species.alleleLabelMap[allele]\n\n  _setupListeners: ->\n    Events.addEventListener EventTypes.MEIOSIS.RESET, (evt) =>\n      if evt.detail.owner is @opts.meiosisOwner and evt.detail.mode is @opts.mode\n        @_reset()\n        Events.dispatchEvent EventTypes.MEIOSIS.GAMETE_SELECTED, {owner: @opts.meiosisOwner, gamete: null}\n    Events.addEventListener EventTypes.MEIOSIS.GAMETE_SELECTED, (evt) =>\n      if @opts.mode is 'offspring'\n        if evt.detail.owner is 'mother'\n          @motherData = evt.detail.gamete\n        else\n          @fatherData = evt.detail.gamete\n        @_reset()\n\n  _reset: ->\n    @_setJsonData()\n    @_injectHtml()\n    @_initAnimation()\n\n  _setJsonData: ->\n    if @opts.mode is 'offspring'\n      if @motherData? and @fatherData?\n        @jsonData = { chromosomes: [] }\n        @jsonData.chromosomes = @jsonData.chromosomes.concat(@motherData.chromosomes)\n        @jsonData.chromosomes = @jsonData.chromosomes.concat(@fatherData.chromosomes)\n      else if @motherData?\n        @jsonData = @motherData\n      else if @fatherData?\n        @jsonData = @fatherData\n      else\n        @jsonData = null\n      Events.dispatchEvent EventTypes.MEIOSIS.OFFSPRING_CREATED, {offspring: null}\n    else if @dragon?\n      @jsonData = MeiosisSupport.allelesToJSON(@dragon.getAlleleString())\n\n  _initAnimation: ->\n    @jsonData = @opts.jsonDataUrl unless @jsonData?\n\n    options =\n      mode: @opts.mode\n      swap: @opts.swapping isnt 'none'\n      owner: @opts.meiosisOwner\n      mother: @motherData\n      father: @fatherData\n      segMoveSpeed: 5\n      width: @opts.width\n      height: @opts.height\n      context: @\n      loaded: @_animationLoaded\n      animationComplete: @_animationComplete\n      gameteSelected: @_gameteSelected\n      playButtonPressed: @_playButtonPressed\n      endButtonPressed: @_endButtonPressed\n      reachedRecombination: @_reachedRecombination\n      allelesSelected: @_allelesSelected\n      swapCompleted: @_swapCompleted\n      ySwapAttempted: @_ySwapAttempted\n\n    @_injectHtml() unless @_div?\n    if @jsonData?\n      @_div.geniverse(@jsonData, options)\n\n  _injectHtml: ->\n    d = document.createElement 'div'\n    d.classList.add 'meiosis'\n\n    out = ''\n    out += '<div class=\"cell\"></div>'\n    out += '<div class=\"controls\">'\n\n    out += '<div class=\"buttons\">'\n    out += '<button class=\"stop\"><img src=\"images/meiosis/meiosis_stop_small.png\" /></button>'\n    out += '<button class=\"play\"><img src=\"images/meiosis/meiosis_play_small.png\" /></button>'\n    out += '<button class=\"end\"><img src=\"images/meiosis/meiosis_end_small.png\" /></button>'\n    if @opts.mode is 'parent'\n      if @opts.swapping isnt 'none'\n        out += '<button class=\"swap\"><img src=\"images/meiosis/meiosis_exchange_16x16_monochrome.png\" /></button>'\n      out += '<button class=\"retry\"><img src=\"images/meiosis/meiosis_retry_monochrome.png\" /></button>'\n    out += '</div>'\n\n    out += '<div class=\"scrub\"></div>'\n    out += '</div>'\n\n    d.innerHTML = out\n    @_parent[0].innerHTML = ''\n    @_parent[0].appendChild d\n    @_div = $(d)\n\n  _animationLoaded: ->\n    undefined\n\n  _animationComplete: ->\n    if @opts.mode is 'offspring'\n      alleles = MeiosisSupport.JSONToAlleles @motherData, @fatherData\n      sex = MeiosisSupport.getOffspringSex @fatherData\n      dragon = BioLogica.Organism.createOrganism @opts.species, alleles, sex\n      Events.dispatchEvent EventTypes.MEIOSIS.OFFSPRING_CREATED, {offspring: dragon}\n\n  _gameteSelected: (data)->\n    Events.dispatchEvent EventTypes.MEIOSIS.GAMETE_SELECTED, {owner: @opts.meiosisOwner, gamete: data}\n\n  _playButtonPressed: ->\n    undefined\n\n  _endButtonPressed: ->\n    undefined\n\n  _reachedRecombination: ->\n    undefined\n\n  _allelesSelected: ->\n    undefined\n\n  _swapCompleted: ->\n    undefined\n\n  _ySwapAttempted: ->\n    undefined\n","Events = require 'events'\nEventTypes = require 'event-types'\n\nmodule.exports = class DragonView\n  constructor: (@dragon, domId, {@showSex, @showCharacteristics, @visibleTraits})->\n    @showSex ?= true\n    @showCharacteristics ?= false\n    @visibleTraits ?= []\n\n    @_addListeners()\n    @div = $(domId)[0]\n    @div.classList.add 'dragon-view-parent'\n    @_injectHtml()\n    @_updateClasses()\n\n  setDragon: (@dragon)->\n    @_updateClasses()\n    @_updateCharacteristics()\n    @_updateSexLabel()\n    @_updateVisibility()\n\n  setSexVisible: (@showSex) ->\n    @_updateVisibility()\n\n  setCharacteristicsVisible: (@showCharacteristics) ->\n    @_updateVisibility()\n\n  _addListeners: ->\n    Events.addEventListener EventTypes.DRAGON.ALLELES_CHANGED, (evt)=>\n      if evt.detail.dragon is @dragon\n        @_updateClasses()\n        @_updateCharacteristics()\n        @_updateSexLabel()\n\n  _updateClasses: ->\n    @phenoView.setAttribute('class', '')\n    @phenoView.classList.add 'dragon-view'\n    if not @dragon?\n      @phenoView.classList.add 'no-dragon'\n      return\n    for characteristic in @dragon.getAllCharacteristics()\n      characteristic = characteristic.toLowerCase().replace(' ', '-')\n      @phenoView.classList.add characteristic\n\n  _updateVisibility: ->\n    if @dragon? and @showSex\n      @sexLabel.classList.remove('hidden') if @sexLabel.classList.contains('hidden')\n    else\n      @sexLabel.classList.add 'hidden'\n\n    if @dragon? and @showCharacteristics\n      @characteristicList.classList.remove('hidden') if @characteristicList.classList.contains('hidden')\n    else\n      @characteristicList.classList.add 'hidden'\n\n  _updateCharacteristics: ->\n    return unless @dragon?\n    out = []\n    for own trait, characteristic of @dragon.phenotype.characteristics\n      continue if @visibleTraits.length > 0 and trait not in @visibleTraits\n      out.push \"<span class='trait'>#{trait}:</span> <span class='characteristic'>#{characteristic}</span>\"\n\n    @characteristicList.innerHTML = out.join('')\n\n  _updateSexLabel: ->\n    return unless @dragon?\n    @sexLabel.innerHTML = if @dragon.sex is BioLogica.MALE then \"male\" else \"female\"\n\n  _injectHtml: ->\n    @phenoView = document.createElement 'div'\n    @phenoView.classList.add 'dragon-view'\n    @div.appendChild @phenoView\n    for part in ['body','dead','fire','head','plates','scales','wings']\n      partImg = document.createElement 'img'\n      partImg.classList.add part\n      partImg.src = \"images/dragons/#{part}.png\"\n      @phenoView.appendChild partImg\n\n    @sexLabel = document.createElement 'div'\n    @sexLabel.classList.add 'sex-label'\n    @sexLabel.classList.add 'hidden' unless @showSex\n    @div.appendChild @sexLabel\n\n    @characteristicList = document.createElement 'div'\n    @characteristicList.classList.add 'characteristic-list'\n    @characteristicList.classList.add 'hidden' unless @showCharacteristics\n    @div.appendChild @characteristicList\n\n    @_updateSexLabel()\n    @_updateCharacteristics()\n    @_updateVisibility()\n\n"]}